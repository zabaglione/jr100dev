# key_display サンプル

## 概要
- JR-100 の VIA ポートを直接操作し、キーマトリクスを行単位でスキャンするサンプルです。
- 押されたキー (SHIFT/CTRL/RETURN/SPACE は専用文字列) を画面中央に表示し、長押しでも点滅しないようにラッチ制御を入れています。
- 1 フレームにつき 1 行だけ解析し、最初に見つけたキーのみを採用することで揺らぎを抑えています。

## ビルド
```sh
PYTHONPATH=/path/to/jr100dev python -m jr100dev.cli.main assemble main.asm \
  --obj build/key_display.json --bin build/key_display.bin --map build/key_display.map -o build/key_display.prg
```

## 実行
1. エミュレーターで `build/key_display.prg` をロードし、`A=USR($300)` を実行します。
2. 画面下部に操作説明が表示され、キーを押すと中央 (列15, 行11) に文字またはラベルが表示されます。
3. 同じキーを押し続けると表示は変化せず、キーを離して 2 フレーム (約 4ms) 経過すると空白に戻ります。

## メモ
- `READ_ROW_STABLE` で同じ行を 2 回連続で読み、値が一致した場合のみ有効入力とみなしています。配線揺らぎやチャタリングをソフトウェアで取り除く例として活用できます。
- サンプルは単一キー前提で設計されています。複数キー同時押しを許可したい場合は `KEY_FOUND` フラグの制御を調整し、複数の結果を格納できるようにしてください。
- ループ末尾で 2ms 程度の待機を入れており、CPU 使用率を抑えつつ安定したスキャンを実現しています。
