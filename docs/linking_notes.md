# リンク処理メモ（MVP）

## 目的
`assemble` が生成する JSON オブジェクト（`jr100dev-object`）を複数受け取り、重複がないことを確認した上で 1 本のバイナリおよび `.prg` を作成する。

## 前提
- 各オブジェクトは `sections[*].address` で絶対アドレスを指定している。
- `relocations` は現時点で空配列。再配置は未対応。
- 全オブジェクトの `entry_point` は一致している前提。CLI で上書き指定も可能にする。

## アルゴリズム
1. JSON を読み込み、`sections[*].content` をバイト列へ復元する（16進表記想定）。
2. 全セクションをアドレス順に整列し、オーバーラップが無いかチェックする。
3. 最小アドレスを `origin`、最大アドレス＋長さを `end_address` として `bytearray` を確保し、欠けている区間は `0x00` でパディングする。
4. セクションデータを `image[offset:offset+len]` に書き込む。
5. シンボルテーブルを統合し、重複名は同一値のみ許可、それ以外はエラー。
6. CLI で `.bin` と `.prg` を出力し、`.map` が指定されていれば統合シンボルを出力する。

## エラー条件
- 未知フォーマット／バージョン。
- セクションが重複、または 64KiB を越える場合。
- シンボル名が同一で値が異なる場合。
- オブジェクトが 1 つも指定されない場合。

## 次ステップ
- 再配置情報（`relocations`）に対応し、シンボル解決とアドレス再配置を実装する。
- セクション属性ごとに出力領域を切り替える設計（BSS、データ等）。
- `.prg` のエントリポイントを CLI で明示的に指定できるようにする（現状はオブジェクトの値／上書きを使用）。
